<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Find the Carrots Game</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
<style>
html, body { height:100%; margin:0; display:flex; justify-content:center; align-items:center; background:#a8e6cf; font-family: Arial, sans-serif; }
#container { display:flex; flex-direction:column; align-items:center; }
.header { font-size:24px; margin-bottom:10px; color:#333; font-weight:bold; text-align:center; }
#game-container { width:600px; height:600px; position:relative; }
canvas { border:3px solid #333; display:block; margin:auto; }
#resetButton { margin-top:10px; padding:8px 16px; font-size:16px; border:none; border-radius:6px; background:#2b8a3e; color:white; cursor:pointer; display:none; }
</style>
</head>
<body>
<div id="container">
  <div class="header">Find all carrots before farmer catches you!</div>
  <div id="game-container"></div>
  <button id="resetButton">Play Again</button>
</div>

<script>
const WIDTH = 600;
const HEIGHT = 600;
const HEADER_HEIGHT = 50;
const GRID_ROWS = 5;
const GRID_COLS = 5;
const TILE_SIZE = (HEIGHT - 20) / GRID_ROWS; // ensure all rows fit

class Boot extends Phaser.Scene {
  constructor(){ super('Boot'); }
  create(){ this.scene.start('Main'); }
}

class Main extends Phaser.Scene {
  constructor(){ super('Main'); }
  init(){ this.carrotsFound = 0; this.gameOver = false; }

  create(){
    // --- Bunny in background ---
    this.add.text(WIDTH/2, HEIGHT/2, 'üê∞', {font:`80px Arial`}).setOrigin(0.5).setAlpha(0.2);

    // --- Message text ---
    this.message = this.add.text(WIDTH/2, 20, '', {font:'20px Arial', fill:'#333'}).setOrigin(0.5);

    // --- Tile grid ---
    this.tilesGroup = this.add.group();
    this.tilesData = [];

    const topOffset = 60;

    for(let r=0;r<GRID_ROWS;r++){
      this.tilesData[r] = [];
      for(let c=0;c<GRID_COLS;c++){
        const x = c*TILE_SIZE + TILE_SIZE/2;
        const y = r*TILE_SIZE + TILE_SIZE/2 + topOffset;
        const tileRect = this.add.rectangle(x, y, TILE_SIZE-4, TILE_SIZE-4, 0xffffff).setStrokeStyle(2, 0x333);
        const tileText = this.add.text(x, y, 'üå´Ô∏è', {font:`${TILE_SIZE/2}px Arial`}).setOrigin(0.5);
        tileRect.setInteractive();
        tileRect.row = r; tileRect.col = c;
        tileRect.revealed = false;
        tileRect.text = tileText;
        tileRect.on('pointerdown', ()=>this.revealTile(tileRect));
        this.tilesGroup.add(tileRect);
        this.tilesData[r][c] = tileRect;
      }
    }

    this.resetButton = document.getElementById('resetButton');
    this.resetButton.addEventListener('click', ()=>this.resetGame());

    this.resetGame();
  }

  resetGame(){
    this.carrotsFound = 0;
    this.gameOver = false;
    this.message.setText('');
    this.resetButton.style.display = 'none';
    this.totalCarrots = 5;
    this.prizeCount = 1;

    this.tiles = [];

    // Reset tiles
    for(let r=0;r<GRID_ROWS;r++){
      for(let c=0;c<GRID_COLS;c++){
        const t = this.tilesData[r][c];
        t.revealed = false;
        t.content = 'empty';
        t.text.setText('üå´Ô∏è');
        this.tiles.push(t);
      }
    }

    // Place carrots
    for(let i=0;i<this.totalCarrots;i++){
      let t = Phaser.Utils.Array.GetRandom(this.tiles.filter(t=>t.content==='empty'));
      t.content = 'carrot';
    }

    // Place prize
    let prizeTile = Phaser.Utils.Array.GetRandom(this.tiles.filter(t=>t.content==='empty'));
    prizeTile.content = 'prize';

    // Place farmer
    let farmerTile = Phaser.Utils.Array.GetRandom(this.tiles.filter(t=>t.content==='empty'));
    farmerTile.content = 'farmer';
  }

  revealTile(tile){
    if(this.gameOver || tile.revealed) return;
    tile.revealed = true;

    if(tile.content === 'carrot'){
      tile.text.setText('ü•ï');
      this.carrotsFound++;
      if(this.carrotsFound === this.totalCarrots){
        this.endGame('You found all carrots! You win!');
      }
    } else if(tile.content === 'prize'){
      tile.text.setText('üéÅ');
      this.endGame('You found the prize! Instant win!');
    } else if(tile.content === 'farmer'){
      tile.text.setText('üë®‚Äçüåæ');
      this.endGame('Oops! You clicked the farmer. Game over.');
    } else {
      tile.text.setText('ü™¥'); // reveal plant for empty tiles clicked
    }
  }

  endGame(message){
    this.gameOver = true;
    this.message.setText(message);

    // Reveal all remaining carrots and empty plants
    this.tiles.forEach(t=>{
      if(!t.revealed){
        if(t.content === 'carrot') t.text.setText('ü•ï');
        else if(t.content === 'prize') t.text.setText('üéÅ');
        else if(t.content === 'farmer') t.text.setText('üë®‚Äçüåæ');
        else t.text.setText('ü™¥');
      }
    });

    this.resetButton.style.display = 'block'; // show play again button
  }
}

const config = {
  type: Phaser.AUTO,
  parent: 'game-container',
  width: WIDTH,
  height: HEIGHT,
  backgroundColor: 0xa8e6cf,
  scene: [Boot, Main],
  physics: { default:'arcade', arcade:{ debug:false } }
};

window.game = new Phaser.Game(config);
</script>
</body>
</html>
