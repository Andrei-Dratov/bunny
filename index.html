<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Telegram Mini Game â€” Runner</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <style>
    html, body { height:100%; margin:0; background: linear-gradient(#87CEEB, #ffffff); }
    #game-container { width:100%; height:100vh; display:flex; align-items:center; justify-content:center; }
    canvas { max-width:100%; height:auto; }
    .overlay { position: absolute; top:10px; left:10px; font-family: Arial, Helvetica, sans-serif; color:#222; background: rgba(255,255,255,0.75); padding:6px 8px; border-radius:6px; }
  </style>
</head>
<body>
  <div id="game-container"></div>
  <div class="overlay" id="hud">Score: 0</div>

<script>
const WIDTH = Math.min(window.innerWidth, 900);
const HEIGHT = Math.min(window.innerHeight, 600);
const GROUND_HEIGHT = 96;

class Boot extends Phaser.Scene {
  constructor(){ super('Boot'); }
  create(){ this.scene.start('Main'); }
}

class Main extends Phaser.Scene {
  constructor(){ super('Main'); }
  init(){ this.score = 0; this.gameOver = false; }

  create(){
    // --- BACKGROUND ---
    // sky
    this.add.rectangle(0, 0, WIDTH, HEIGHT, 0x8ed6ff).setOrigin(0,0);
    // simple hills
    this.hillsGroup = this.add.group();
    for(let i=0;i<5;i++){
      const hill = this.add.ellipse(i*180, HEIGHT-50, 180, 80, 0x2b8a3e);
      this.hillsGroup.add(hill);
    }

    // --- GROUND ---
    this.groundGroup = this.add.group();
    for(let i=0;i<Math.ceil(WIDTH/60)+2;i++){
      const plank = this.add.rectangle(i*60, HEIGHT-GROUND_HEIGHT/2, 50, GROUND_HEIGHT, 0x6b4f2f);
      this.groundGroup.add(plank);
    }

    // --- PLAYER ---
    this.player = this.add.rectangle(120, HEIGHT-GROUND_HEIGHT-30, 60, 60, 0xffd166);
    this.physics.add.existing(this.player);
    this.player.body.setSize(60,60);
    this.player.body.setGravityY(1400);
    this.player.body.setCollideWorldBounds(true);

    // --- FLOOR COLLIDER ---
    this.floor = this.add.rectangle(WIDTH/2, HEIGHT-GROUND_HEIGHT/2, WIDTH, GROUND_HEIGHT).setVisible(false);
    this.physics.add.existing(this.floor, true);
    this.physics.add.collider(this.player, this.floor);

    // --- GROUPS ---
    this.obstacles = this.physics.add.group();
    this.coins = this.physics.add.group();
    this.physics.add.collider(this.player, this.obstacles, this.hitObstacle, null, this);
    this.physics.add.overlap(this.player, this.coins, this.collectCoin, null, this);

    // --- CONTROLS ---
    this.cursors = this.input.keyboard.createCursorKeys();
    this.input.on('pointerdown', ()=>this.tryJump());

    // --- SPAWN TIMERS ---
    this.spawnTimer = this.time.addEvent({ delay: 1200, callback: this.spawnObstacle, callbackScope: this, loop:true });
    this.coinTimer = this.time.addEvent({ delay: 900, callback: this.spawnCoin, callbackScope: this, loop:true });

    // --- HUD ---
    this.hud = document.getElementById('hud');
    this.updateHUD();

    // --- CAMERA ---
    this.cameras.main.startFollow(this.player, false, 0.08, 0.08);
    this.cameras.main.setBounds(0,0,999999, HEIGHT);

    // --- WORLD SPEED ---
    this.worldSpeed = 340;

    // --- MOBILE HINT ---
    if(/Mobi|Android/i.test(navigator.userAgent)){
      this.add.text(20,20,'Tap to jump', {font:'16px Arial', fill:'#222'}).setScrollFactor(0).setDepth(5);
    }
  }

  update(time, delta){
    if(this.gameOver) return;
    const step = this.worldSpeed * delta/1000;

    // Move hills & ground
    this.hillsGroup.children.iterate(h => { h.x -= step*0.2; if(h.x+90<0) h.x += WIDTH + 180; });
    this.groundGroup.children.iterate(g => { g.x -= step*0.4; if(g.x+25<0) g.x += WIDTH + 60; });

    // Move obstacles & coins
    Phaser.Actions.Call(this.obstacles.getChildren(), o=>{ o.x -= step; if(o.x<-100) o.destroy(); });
    Phaser.Actions.Call(this.coins.getChildren(), c=>{ c.x -= step; if(c.x<-100) c.destroy(); });

    // Jump input
    if(this.cursors.up.isDown || this.cursors.space.isDown) this.tryJump();

    // Increase speed gradually
    if(Math.floor(time/10000)>0) this.worldSpeed = 340 + Math.floor(time/10000)*20;
  }

  tryJump(){
    if(this.player.body.touching.down || this.player.body.onFloor()){
      this.player.body.setVelocityY(-620);
    }
  }

  spawnObstacle(){
    const x = this.cameras.main.worldView.x + WIDTH + 60;
    const y = HEIGHT - GROUND_HEIGHT - 30;
    const spike = this.add.triangle(x, y, 0,60, 30,0, 60,60, 0xff3b3b);
    this.physics.add.existing(spike);
    spike.body.setAllowGravity(false);
    spike.body.setImmovable(true);
    this.obstacles.add(spike);
  }

  spawnCoin(){
    const x = this.cameras.main.worldView.x + WIDTH + Phaser.Math.Between(20,140);
    const y = Phaser.Math.Between(HEIGHT - GROUND_HEIGHT - 100, HEIGHT - GROUND_HEIGHT - 40);
    const coin = this.add.circle(x, y, 14, 0xffd700);
    this.physics.add.existing(coin);
    coin.body.setAllowGravity(false);
    this.coins.add(coin);
  }

  collectCoin(player, coin){
    coin.destroy();
    this.score += 10;
    this.updateHUD();
  }

  hitObstacle(){
    this.gameOver = true;
    this.player.fillColor = 0xff6666;
    this.player.body.setVelocity(0,0);
    this.spawnTimer.remove();
    this.coinTimer.remove();

    this.add.text(this.cameras.main.worldView.x+WIDTH/2, HEIGHT/2-40,'Game Over',{fontSize:'40px', fontFamily:'Arial', color:'#222'}).setOrigin(0.5);
    this.add.text(this.cameras.main.worldView.x+WIDTH/2, HEIGHT/2+10,'Score: '+this.score,{fontSize:'22px', fontFamily:'Arial', color:'#222'}).setOrigin(0.5);

    const btn = this.add.text(this.cameras.main.worldView.x+WIDTH/2, HEIGHT/2+70,'Play again',{fontSize:'20px', fontFamily:'Arial', backgroundColor:'#2b8a3e', padding:{x:10,y:8}, color:'#fff'}).setOrigin(0.5).setInteractive();
    btn.on('pointerdown', ()=>this.scene.restart());
  }

  updateHUD(){ this.hud.innerText = 'Score: ' + this.score; }
}

const config = {
  type: Phaser.AUTO,
  parent: 'game-container',
  width: WIDTH,
  height: HEIGHT,
  physics: { default:'arcade', arcade:{ gravity:{y:0}, debug:false } },
  scene: [Boot, Main]
};

window.addEventListener('load', ()=>{ window.game = new Phaser.Game(config); });
window.addEventListener('resize', ()=>{ location.reload(); });
</script>
</body>
</html>
